# [斐波那契数](https://leetcode.cn/problems/fibonacci-number/description/)

=== "矩阵加速"

    ```java
    class Solution {

        long[][] mmul(long[][] a, long[][] b, int x, int y, int z, long mod) {
            
            long[][] res = new long[x + 1][z + 1];
            
            for (int i = 1; i <= x; i ++) {
                for (int j = 1; j <= z; j ++) {
                    for (int k = 1; k <= y; k ++) {
                        res[i][j] += a[i][k] * b[k][j] % mod;
                        res[i][j] %= mod;
                    }
                }
            }
            
            return res;
        }
        
        long[][] mqpow(long[][] a, int n, long x, long mod) {
            if (x == 0) {
                long[][] res = new long[n + 1][n + 1];
                
                for (int i = 1; i <= n; i ++) {
                    res[i][i] = 1L;
                }
                
                return res;
            }
            
            if (x == 1L) return a;
            
            long[][] res = mqpow(a, n, x >> 1, mod);
            res = mmul(res, res, n, n, n, mod);
            if ((x & 1L) == 1L) res = mmul(res, a, n, n, n, mod);
            return res;
        }

        int inf = ~(1 << 31);

        public int fib(int n) {
            if (n == 0 || n == 1) return n;

            long[][] a = new long[2][3];
            a[1][1] = 0;
            a[1][2] = 1;

            long[][] b = new long[3][3];
            b[1][2] = b[2][1] = b[2][2] = 1;

            long[][] res = mqpow(b, 2, n - 1, (long)inf);
            res = mmul(a, res, 1, 2, 2, (long)inf);

            return (int)res[1][2]; 
        }
    }
    ```