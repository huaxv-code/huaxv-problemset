# [所有奇数长度子数组的和](https://leetcode.cn/problems/sum-of-all-odd-length-subarrays/description/)

??? success "代码参考"

    ```java
    class Solution {
        
        public int gmi(int x) {
            if ((x & 1) == 1) return x;
            return x - 1;
        }

        public int gsm(int x) {
            return (1 + x) * (x + 1) / 4;
        }

        public int gct(int x) {
            return (x + 1) / 2;
        }

        int n, res;
        int[] as;
        int[] rs;
        int[] st;
        int[] ah;

        public int sumOddLengthSubarrays(int[] arr) {
            n = arr.length;
            res = 0;

            as = new int[n + 1];
            rs = new int[n + 1];
            st = new int[n + 1];
            ah = new int[n + 1];

            for (int i = 1; i <= n; i ++) {
                as[i] = arr[i - 1];
                st[i] = gct(gmi(n - i + 1));
                rs[i] = rs[i - 1] + st[i];
            }

            for (int i = 1; i <= n; i ++) {
                if (i == 1) ah[i] = 1;
                else {
                    ah[i] = ah[i - 1] + gct(gmi(i));
                }
            }

            for (int i = 1; i <= n; i ++) {
                rs[i] -= ah[i - 1];
                res += rs[i] * as[i];
            }

            return res;
        }
    }
    ```