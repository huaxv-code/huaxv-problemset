# [二叉树的最短路径](https://www.acwing.com/problem/content/3558/)

=== "欧拉序 + 节点深度 + ST 表"

    ```java
    import java.util.* ;
    import java.io.* ;
    import java.math.* ;

    public class Main {

        int N = 10000;
        
        int[] st = new int[N]; // 点 i 第一次出现的位置
        int[] ed = new int[N]; // 点 j 第一次出现的位置

        int[] de = new int[N]; // 深度

        int[] g = new int[N];
        int[] e = new int[N];
        int[] ne = new int[N];
        int cur;

        int[][][] dp = new int[N][25][2]; // 区间最小值

        int[] ELR = new int[N]; // 欧拉序
        int cnt;

        int[] log = new int[N]; // 求对数 log(2, n)

        int n, m;

        void init() {
            log[1] = 0;
            for (int i = 2; i <= cnt; i ++) {
                log[i] = log[i >> 1] + 1;
            }

            for (int i = 1; i <= cnt; i ++) {
                dp[i][0][0] = de[ELR[i]];
                dp[i][0][1] = ELR[i];
            }

            // for (int i = 1; i <= cnt; i ++) {
            //     cout.println(i + " " + dp[i][0][0] + " " + dp[i][0][1]);
            // }

            for (int i = 1; i <= log[cnt]; i ++) {
                for (int j = 1; j + (1 << i) - 1 <= cnt; j ++) {
                    int k = j + (1 << i) - 1;
                    if (dp[j][i - 1][0] <= dp[k - (1 << (i - 1)) + 1][i - 1][0]) {
                        dp[j][i][0] = dp[j][i - 1][0];
                        dp[j][i][1] = dp[j][i - 1][1];
                    } else {
                        dp[j][i][0] = dp[k - (1 << (i - 1)) + 1][i - 1][0];
                        dp[j][i][1] = dp[k - (1 << (i - 1)) + 1][i - 1][1];
                    }
                }
            }
        }

        void dfs(int p, int f) {
            st[p] = ++ cnt;
            ELR[cnt] = p;

            for (int i = g[p]; i > 0; i = ne[i]) {
                if (e[i] == f) continue;
                dfs(e[i], p);
                ELR[++ cnt] = p;
            }

            ed[p] = cnt;
        }

        void deep(int v, int u, int x) {
            de[v] = x;
            for (int i = g[v]; i > 0; i = ne[i]) {
                if (e[i] == u) continue;
                deep(e[i], v, x + 1);
            }
        }

        void add(int x, int y) {
            cur ++; 
            e[cur] = y;
            ne[cur] = g[x];
            g[x] = cur;
        }

        int query(int x, int y) {
            if (st[x] > st[y]) {
                int t = x; x = y; y = t;
            }
            int len = (st[y] - st[x] + 1);
            if (dp[st[x]][log[len]][0] <= dp[st[y] - (1 << log[len]) + 1][log[len]][0]) 
                return dp[st[x]][log[len]][1];
            else return dp[st[y] - (1 << log[len]) + 1][log[len]][1];
        }

        public void solve() throws Exception {
            
            String[] ts = cin.readLine().split(space);

            n = gii(ts[0]); m = gii(ts[1]);

            cur = 0; cnt = 0;

            for (int i = 1; i <= 3 * n; i ++) {
                g[i] = 0; e[i] = 0; ne[i] = 0;
            }

            for (int i = 1; i <= n; i ++) {
                ts = cin.readLine().split(space);
                int x = gii(ts[0]);
                int y = gii(ts[1]);
                if (x > -1) {
                    add(i, x);
                } 
                if (y > -1) {
                    add(i, y);
                }
            }

            deep(1, 0, 1);

            dfs(1, 0);

            init();

            // for (int i = 1; i <= cnt; i ++) {
            //     cout.print(ELR[i] + " ");
            // }
            // cout.println();

            // for (int i = 1; i <= n; i ++) {
            //     cout.print(st[i] + " ");
            // }
            // cout.println();

            for (int i = 1; i <= m; i ++) {
                ts = cin.readLine().split(space);
                int x = gii(ts[0]);
                int y = gii(ts[1]);

                int z = query(x, y);

                cout.println(-(de[z] - de[x] + de[z] - de[y]));
            }
            
        }

        public static void main(String[] args) throws Exception {
            
            Main cmd = new Main();
            int t = gii(cin.readLine().split(space)[0]);
            while (t -- > 0) cmd.solve();
            cout.flush();
            
        }

        public static String space = "\\s+"; 

        public static BufferedReader cin = new BufferedReader(new InputStreamReader(System.in));
        public static PrintWriter cout = new PrintWriter(new OutputStreamWriter(System.out));

        public static int gii(String s) {
            return Integer.parseInt(s);
        }

        public static long gll(String s) {
            return Long.parseLong(s);
        }

        public static double gff(String s) {
            return Double.parseDouble(s);
        }
    }
    ```