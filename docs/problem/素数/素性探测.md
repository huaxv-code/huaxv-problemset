# 素性探测

??? question "[题目描述]()"

    给定一个数 $n$ 请你判断该数是否是质数;

    **数据范围**

    $1 \leq n \leq 2 ^ {63} - 1$

    **输入输出**

    【输入格式】

    第一行输入一个数 $n$

    【输出格式】

    输出一行，如果是质数，输出 $yes$，否则输出 $no$

    **样例一**

    输入：

    ```
    9223372036854775807
    ```

    输出：

    ```
    no
    ```

    **样例二**

    输入：

    ```
    2147483647
    ```

    输出：

    ```
    yes
    ```

    **样例三**

    输入：

    ```
    9223372036854775783
    ```

    输出：

    ```
    yes
    ```

## 素性探测

**定理**

如果 $p$ 是奇素数，且 $x < p$ 或 $x$ 与 $p$ 互质，则：

> $x ^ {p - 1} = 1 (\bmod p)$.
>
> $x ^ 2 = 1 (\bmod p)$ 时，$x = 1$ 或 $x = p - 1$.

---

如果一开始 $x ^ {p - 1} = 1 (\bmod p)$ 那么 $p$ 很可能是素数；

如果 $x ^ {p - 1} = 1$ 的解 $x ^ \frac{p - 1}{2} = 1 或 p - 1$ 时，$p$ 也很可能是素数；

```
{ 2, 325, 9375, 28178, 450775, 9780504, 1795265022 }
```

!!! note "代码参考"

    ```c++
    bool isp(HH p)
    {
        if (p <= 2) return p == 2;
        if (p % 2 == 0) return false;

        vector<HH> tmp = {2, 325, 9375, 28178, 450775, 9780504, 1795265022};

        HH t = p - 1, s = 0;
        while (t % 2 == 0) t /= 2, s ++;

        for (HH a : tmp)
        {
            if (a >= p) continue; // 保证 a 和 p 互素，即 a < p
            HH res = qpow(a, t, p);
            if (res == 1) continue; // 向上平方也一定是 1 通过测试

            HH on = 1;
            for (LL i = 1; i <= s; i ++)
            {
                if (res == p - 1) { on = 0; break; } // 通过测试，p - 1 向上平方为 1
                res = (res * res) % p;
            }
            // 此时 res 恢复成  a ^ {p - 1}
            if (on) return false;
            // if (res != 1 || res != p - 1) return false; // 到 p-1 处提前退出时就会没有恢复原样
            // 只有 1 和 p-1 向上平方才会为 1
            // 所以如果执行到 res 恢复原样之前都没出现 p-1 就一定不会有 res 恢复原样后为 1.
        }

        return true;
    }
    ```